/*! 2015 Baidu Inc. All Rights Reserved */
define("common/lib/q",["require"],function(require){"use strict";function e(e){return function(){return Q.apply(e,arguments)}}function t(e){return e===Object(e)}function r(e){return"[object StopIteration]"===te(e)||e instanceof B}function n(e,t){if($&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(re)){for(var r=[],n=t;n;n=n.source)if(n.stack)r.unshift(n.stack);r.unshift(e.stack);var o=r.join("\n"+re+"\n");e.stack=i(o)}}function i(e){for(var t=e.split("\n"),r=[],n=0;n<t.length;++n){var i=t[n];if(!s(i)&&!o(i)&&i)r.push(i)}return r.join("\n")}function o(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(r)return[r[1],Number(r[2])];var n=/.*@(.+):(\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];else return void 0}function s(e){var t=a(e);if(!t)return!1;var r=t[0],n=t[1];return r===V&&n>=U&&ae>=n}function l(){if($)try{throw new Error}catch(e){var t=e.stack.split("\n"),r=t[0].indexOf("@")>0?t[1]:t[2],n=a(r);if(!n)return;return V=n[0],n[1]}}function c(e,t,r){return function(){if("undefined"!=typeof console&&"function"==typeof console.warn)console.warn(t+" is deprecated, use "+r+" instead.",new Error("").stack);return e.apply(e,arguments)}}function u(e){if(v(e))return e;if(y(e))return E(e);else return _(e)}function d(){function e(e){t=e,o.source=e,G(r,function(t,r){W(function(){e.promiseDispatch.apply(e,r)})},void 0),r=void 0,n=void 0}var t,r=[],n=[],i=Y(d.prototype),o=Y(f.prototype);if(o.promiseDispatch=function(e,i,o){var a=Z(arguments);if(r){if(r.push(a),"when"===i&&o[1])n.push(o[1])}else W(function(){t.promiseDispatch.apply(t,a)})},o.valueOf=function(){if(r)return o;var e=h(t);if(v(e))t=e;return e},o.inspect=function(){if(!t)return{state:"pending"};else return t.inspect()},u.longStackSupport&&$)try{throw new Error}catch(a){o.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(r){if(!t)e(u(r))},i.fulfill=function(r){if(!t)e(_(r))},i.reject=function(r){if(!t)e(C(r))},i.notify=function(e){if(!t)G(n,function(t,r){W(function(){r(e)})},void 0)},i}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=d();try{e(t.resolve,t.reject,t.notify)}catch(r){t.reject(r)}return t.promise}function m(e){return p(function(t,r){for(var n=0,i=e.length;i>n;n++)u(e[n]).then(t,r)})}function f(e,t,r){if(void 0===t)t=function(e){return C(new Error("Promise does not support operation: "+e))};if(void 0===r)r=function(){return{state:"unknown"}};var n=Y(f.prototype);if(n.promiseDispatch=function(r,i,o){var a;try{if(e[i])a=e[i].apply(n,o);else a=t.call(n,i,o)}catch(s){a=C(s)}if(r)r(a)},n.inspect=r,r){var i=r();if("rejected"===i.state)n.exception=i.reason;n.valueOf=function(){var e=r();if("pending"===e.state||"rejected"===e.state)return n;else return e.value}}return n}function g(e,t,r,n){return u(e).then(t,r,n)}function h(e){if(v(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function v(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function y(e){return t(e)&&"function"==typeof e.then}function b(e){return v(e)&&"pending"===e.inspect().state}function x(e){return!v(e)||"fulfilled"===e.inspect().state}function w(e){return v(e)&&"rejected"===e.inspect().state}function k(){if(ne.length=0,ie.length=0,!oe)oe=!0}function S(e,t){if(oe)if(ie.push(e),t&&"undefined"!=typeof t.stack)ne.push(t.stack);else ne.push("(no stack) "+t)}function q(e){if(oe){var t=J(ie,e);if(-1!==t)ie.splice(t,1),ne.splice(t,1)}}function C(e){var t=f({when:function(t){if(t)q(this);return t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return S(t,e),t}function _(e){return f({when:function(){return e},get:function(t){return e[t]},set:function(t,r){e[t]=r},"delete":function(t){delete e[t]},post:function(t,r){if(null===t||void 0===t)return e.apply(void 0,r);else return e[t].apply(e,r)},apply:function(t,r){return e.apply(t,r)},keys:function(){return ee(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function E(e){var t=d();return W(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(r){t.reject(r)}}),t.promise}function N(e){return f({isDef:function(){}},function(t,r){return L(e,t,r)},function(){return u(e).inspect()})}function R(e,t,r){return u(e).spread(t,r)}function A(e){return function(){function t(e,t){var a;if("undefined"==typeof StopIteration){try{a=n[e](t)}catch(s){return C(s)}if(a.done)return a.value;else return g(a.value,i,o)}else{try{a=n[e](t)}catch(s){if(r(s))return s.value;else return C(s)}return g(a,i,o)}}var n=e.apply(this,arguments),i=t.bind(t,"next"),o=t.bind(t,"throw");return i()}}function T(e){u.done(u.async(e)())}function P(e){throw new B(e)}function O(e){return function(){return R([this,j(arguments)],function(t,r){return e.apply(t,r)})}}function L(e,t,r){return u(e).dispatch(t,r)}function j(e){return g(e,function(e){var t=0,r=d();if(G(e,function(n,i,o){var a;if(v(i)&&"fulfilled"===(a=i.inspect()).state)e[o]=a.value;else++t,g(i,function(n){if(e[o]=n,0===--t)r.resolve(e)},r.reject,function(e){r.notify({index:o,value:e})})},void 0),0===t)r.resolve(e);return r.promise})}function D(e){return g(e,function(e){return e=X(e,u),g(j(X(e,function(e){return g(e,H,H)})),function(){return e})})}function I(e){return u(e).allSettled()}function z(e,t){return u(e).then(void 0,void 0,t)}function M(e,t){return u(e).nodeify(t)}var $=!1;try{throw new Error}catch(F){$=!!F.stack}var V,B,U=l(),H=function(){},W=function(){function e(){for(;t.next;){t=t.next;var r=t.task;t.task=void 0;var i=t.domain;if(i)t.domain=void 0,i.enter();try{r()}catch(a){if(o){if(i)i.exit();if(setTimeout(e,0),i)i.enter();throw a}else setTimeout(function(){throw a},0)}if(i)i.exit()}n=!1}var t={task:void 0,next:null},r=t,n=!1,i=void 0,o=!1;if(W=function(e){if(r=r.next={task:e,domain:o&&process.domain,next:null},!n)n=!0,i()},"undefined"!=typeof process&&process.nextTick)o=!0,i=function(){process.nextTick(e)};else if("function"==typeof setImmediate)if("undefined"!=typeof window)i=setImmediate.bind(window,e);else i=function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){i=s,a.port1.onmessage=e,e()};var s=function(){a.port2.postMessage(0)};i=function(){setTimeout(e,0),s()}}else i=function(){setTimeout(e,0)};return W}(),Q=Function.call,Z=e(Array.prototype.slice),G=e(Array.prototype.reduce||function(e,t){var r=0,n=this.length;if(1===arguments.length)for(;;){if(r in this){t=this[r++];break}if(++r>=n)throw new TypeError}for(;n>r;r++)if(r in this)t=e(t,this[r],r);return t}),J=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),X=e(Array.prototype.map||function(e,t){var r=this,n=[];return G(r,function(i,o,a){n.push(e.call(t,o,a,r))},void 0),n}),Y=Object.create||function(e){function t(){}return t.prototype=e,new t},K=e(Object.prototype.hasOwnProperty),ee=Object.keys||function(e){var t=[];for(var r in e)if(K(e,r))t.push(r);return t},te=e(Object.prototype.toString);if("undefined"!=typeof ReturnValue)B=ReturnValue;else B=function(e){this.value=e};var re="From previous event:";u.resolve=u,u.nextTick=W,u.longStackSupport=!1,u.defer=d,d.prototype.makeNodeResolver=function(){var e=this;return function(t,r){if(t)e.reject(t);else if(arguments.length>2)e.resolve(Z(arguments,1));else e.resolve(r)}},u.Promise=p,u.promise=p,p.race=m,p.all=j,p.reject=C,p.resolve=u,u.passByCopy=function(e){return e},f.prototype.passByCopy=function(){return this},u.join=function(e,t){return u(e).join(t)},f.prototype.join=function(e){return u([this,e]).spread(function(e,t){if(e===t)return e;else throw new Error("Can't join: not the same: "+e+" "+t)})},u.race=m,f.prototype.race=function(){return this.then(u.race)},u.makePromise=f,f.prototype.toString=function(){return"[object Promise]"},f.prototype.then=function(e,t,r){function i(t){try{return"function"==typeof e?e(t):t}catch(r){return C(r)}}function o(e){if("function"==typeof t){n(e,s);try{return t(e)}catch(r){return C(r)}}return C(e)}function a(e){return"function"==typeof r?r(e):e}var s=this,l=d(),c=!1;return W(function(){s.promiseDispatch(function(e){if(!c)c=!0,l.resolve(i(e))},"when",[function(e){if(!c)c=!0,l.resolve(o(e))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,r=!1;try{t=a(e)}catch(n){if(r=!0,u.onerror)u.onerror(n);else throw n}if(!r)l.notify(t)}]),l.promise},u.when=g,f.prototype.thenResolve=function(e){return this.then(function(){return e})},u.thenResolve=function(e,t){return u(e).thenResolve(t)},f.prototype.thenReject=function(e){return this.then(function(){throw e})},u.thenReject=function(e,t){return u(e).thenReject(t)},u.nearer=h,u.isPromise=v,u.isPromiseAlike=y,u.isPending=b,f.prototype.isPending=function(){return"pending"===this.inspect().state},u.isFulfilled=x,f.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},u.isRejected=w,f.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ne=[],ie=[],oe=!0;u.resetUnhandledRejections=k,u.getUnhandledReasons=function(){return ne.slice()},u.stopUnhandledRejectionTracking=function(){k(),oe=!1},k(),u.reject=C,u.fulfill=_,u.master=N,u.spread=R,f.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},u.async=A,u.spawn=T,u["return"]=P,u.promised=O,u.dispatch=L,f.prototype.dispatch=function(e,t){var r=this,n=d();return W(function(){r.promiseDispatch(n.resolve,e,t)}),n.promise},u.get=function(e,t){return u(e).dispatch("get",[t])},f.prototype.get=function(e){return this.dispatch("get",[e])},u.set=function(e,t,r){return u(e).dispatch("set",[t,r])},f.prototype.set=function(e,t){return this.dispatch("set",[e,t])},u.del=u["delete"]=function(e,t){return u(e).dispatch("delete",[t])},f.prototype.del=f.prototype["delete"]=function(e){return this.dispatch("delete",[e])},u.mapply=u.post=function(e,t,r){return u(e).dispatch("post",[t,r])},f.prototype.mapply=f.prototype.post=function(e,t){return this.dispatch("post",[e,t])},u.send=u.mcall=u.invoke=function(e,t){return u(e).dispatch("post",[t,Z(arguments,2)])},f.prototype.send=f.prototype.mcall=f.prototype.invoke=function(e){return this.dispatch("post",[e,Z(arguments,1)])},u.fapply=function(e,t){return u(e).dispatch("apply",[void 0,t])},f.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},u["try"]=u.fcall=function(e){return u(e).dispatch("apply",[void 0,Z(arguments,1)])},f.prototype.fcall=function(){return this.dispatch("apply",[void 0,Z(arguments)])},u.fbind=function(e){var t=u(e),r=Z(arguments,1);return function(){return t.dispatch("apply",[this,r.concat(Z(arguments))])}},f.prototype.fbind=function(){var e=this,t=Z(arguments);return function(){return e.dispatch("apply",[this,t.concat(Z(arguments))])}},u.keys=function(e){return u(e).dispatch("keys",[])},f.prototype.keys=function(){return this.dispatch("keys",[])},u.all=j,f.prototype.all=function(){return j(this)},u.allResolved=c(D,"allResolved","allSettled"),f.prototype.allResolved=function(){return D(this)},u.allSettled=I,f.prototype.allSettled=function(){return this.then(function(e){return j(X(e,function(e){function t(){return e.inspect()}return e=u(e),e.then(t,t)}))})},u.fail=u["catch"]=function(e,t){return u(e).then(void 0,t)},f.prototype.fail=f.prototype["catch"]=function(e){return this.then(void 0,e)},u.progress=z,f.prototype.progress=function(e){return this.then(void 0,void 0,e)},u.fin=u["finally"]=function(e,t){return u(e)["finally"](t)},f.prototype.fin=f.prototype["finally"]=function(e){return e=u(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},u.done=function(e,t,r,n){return u(e).done(t,r,n)},f.prototype.done=function(e,t,r){var i=function(e){W(function(){if(n(e,o),u.onerror)u.onerror(e);else throw e})},o=e||t||r?this.then(e,t,r):this;if("object"==typeof process&&process&&process.domain)i=process.domain.bind(i);o.then(void 0,i)},u.timeout=function(e,t,r){return u(e).timeout(t,r)},f.prototype.timeout=function(e,t){var r=d(),n=setTimeout(function(){r.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(n),r.resolve(e)},function(e){clearTimeout(n),r.reject(e)},r.notify),r.promise},u.delay=function(e,t){if(void 0===t)t=e,e=void 0;return u(e).delay(t)},f.prototype.delay=function(e){return this.then(function(t){var r=d();return setTimeout(function(){r.resolve(t)},e),r.promise})},u.nfapply=function(e,t){return u(e).nfapply(t)},f.prototype.nfapply=function(e){var t=d(),r=Z(e);return r.push(t.makeNodeResolver()),this.fapply(r).fail(t.reject),t.promise},u.nfcall=function(e){var t=Z(arguments,1);return u(e).nfapply(t)},f.prototype.nfcall=function(){var e=Z(arguments),t=d();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},u.nfbind=u.denodeify=function(e){var t=Z(arguments,1);return function(){var r=t.concat(Z(arguments)),n=d();return r.push(n.makeNodeResolver()),u(e).fapply(r).fail(n.reject),n.promise}},f.prototype.nfbind=f.prototype.denodeify=function(){var e=Z(arguments);return e.unshift(this),u.denodeify.apply(void 0,e)},u.nbind=function(e,t){var r=Z(arguments,2);return function(){function n(){return e.apply(t,arguments)}var i=r.concat(Z(arguments)),o=d();return i.push(o.makeNodeResolver()),u(n).fapply(i).fail(o.reject),o.promise}},f.prototype.nbind=function(){var e=Z(arguments,0);return e.unshift(this),u.nbind.apply(void 0,e)},u.nmapply=u.npost=function(e,t,r){return u(e).npost(t,r)},f.prototype.nmapply=f.prototype.npost=function(e,t){var r=Z(t||[]),n=d();return r.push(n.makeNodeResolver()),this.dispatch("post",[e,r]).fail(n.reject),n.promise},u.nsend=u.nmcall=u.ninvoke=function(e,t){var r=Z(arguments,2),n=d();return r.push(n.makeNodeResolver()),u(e).dispatch("post",[t,r]).fail(n.reject),n.promise},f.prototype.nsend=f.prototype.nmcall=f.prototype.ninvoke=function(e){var t=Z(arguments,1),r=d();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},u.nodeify=M,f.prototype.nodeify=function(e){if(e)this.then(function(t){W(function(){e(null,t)})},function(t){W(function(){e(t)})});else return this};var ae=l();return u});