/*! 2015 Baidu Inc. All Rights Reserved */
define("common/lib/q",["require"],function(){"use strict";function e(e){return function(){return J.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===tt(e)||e instanceof B}function r(e,t){if(z&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(nt)){for(var n=[],r=t;r;r=r.source)if(r.stack)n.unshift(r.stack);n.unshift(e.stack);var s=n.join("\n"+nt+"\n");e.stack=i(s)}}function i(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var i=t[r];if(!a(i)&&!s(i)&&i)n.push(i)}return n.join("\n")}function s(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function o(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);if(r)return[r[1],Number(r[2])];else return void 0}function a(e){var t=o(e);if(!t)return!1;var n=t[0],r=t[1];return n===U&&r>=$&&ot>=r}function l(){if(z)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],r=o(n);if(!r)return;return U=r[0],r[1]}}function u(e,t,n){return function(){if("undefined"!=typeof console&&"function"==typeof console.warn)console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack);return e.apply(e,arguments)}}function c(e){if(v(e))return e;if(b(e))return q(e);else return E(e)}function f(){function e(e){t=e,s.source=e,W(n,function(t,n){Q(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],i=X(f.prototype),s=X(m.prototype);if(s.promiseDispatch=function(e,i,s){var o=Z(arguments);if(n){if(n.push(o),"when"===i&&s[1])r.push(s[1])}else Q(function(){t.promiseDispatch.apply(t,o)})},s.valueOf=function(){if(n)return s;var e=g(t);if(v(e))t=e;return e},s.inspect=function(){if(!t)return{state:"pending"};else return t.inspect()},c.longStackSupport&&z)try{throw new Error}catch(o){s.stack=o.stack.substring(o.stack.indexOf("\n")+1)}return i.promise=s,i.resolve=function(n){if(!t)e(c(n))},i.fulfill=function(n){if(!t)e(E(n))},i.reject=function(n){if(!t)e(A(n))},i.notify=function(e){if(!t)W(r,function(t,n){Q(function(){n(e)})},void 0)},i}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=f();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function p(e){return d(function(t,n){for(var r=0,i=e.length;i>r;r++)c(e[r]).then(t,n)})}function m(e,t,n){if(void 0===t)t=function(e){return A(new Error("Promise does not support operation: "+e))};if(void 0===n)n=function(){return{state:"unknown"}};var r=X(m.prototype);if(r.promiseDispatch=function(n,i,s){var o;try{if(e[i])o=e[i].apply(r,s);else o=t.call(r,i,s)}catch(a){o=A(a)}if(n)n(o)},r.inspect=n,n){var i=n();if("rejected"===i.state)r.exception=i.reason;r.valueOf=function(){var e=n();if("pending"===e.state||"rejected"===e.state)return r;else return e.value}}return r}function h(e,t,n,r){return c(e).then(t,n,r)}function g(e){if(v(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function v(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function b(e){return t(e)&&"function"==typeof e.then}function y(e){return v(e)&&"pending"===e.inspect().state}function w(e){return!v(e)||"fulfilled"===e.inspect().state}function x(e){return v(e)&&"rejected"===e.inspect().state}function S(){if(rt.length=0,it.length=0,!st)st=!0}function k(e,t){if(st)if(it.push(e),t&&"undefined"!=typeof t.stack)rt.push(t.stack);else rt.push("(no stack) "+t)}function C(e){if(st){var t=G(it,e);if(-1!==t)it.splice(t,1),rt.splice(t,1)}}function A(e){var t=m({when:function(t){if(t)C(this);return t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return k(t,e),t}function E(e){return m({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){if(null===t||void 0===t)return e.apply(void 0,n);else return e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return et(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function q(e){var t=f();return Q(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function R(e){return m({isDef:function(){}},function(t,n){return D(e,t,n)},function(){return c(e).inspect()})}function I(e,t,n){return c(e).spread(t,n)}function _(e){return function(){function t(e,t){var o;if("undefined"==typeof StopIteration){try{o=r[e](t)}catch(a){return A(a)}if(o.done)return o.value;else return h(o.value,i,s)}else{try{o=r[e](t)}catch(a){if(n(a))return a.value;else return A(a)}return h(o,i,s)}}var r=e.apply(this,arguments),i=t.bind(t,"next"),s=t.bind(t,"throw");return i()}}function N(e){c.done(c.async(e)())}function T(e){throw new B(e)}function P(e){return function(){return I([this,L(arguments)],function(t,n){return e.apply(t,n)})}}function D(e,t,n){return c(e).dispatch(t,n)}function L(e){return h(e,function(e){var t=0,n=f();if(W(e,function(r,i,s){var o;if(v(i)&&"fulfilled"===(o=i.inspect()).state)e[s]=o.value;else++t,h(i,function(r){if(e[s]=r,0===--t)n.resolve(e)},n.reject,function(e){n.notify({index:s,value:e})})},void 0),0===t)n.resolve(e);return n.promise})}function O(e){return h(e,function(e){return e=K(e,c),h(L(K(e,function(e){return h(e,H,H)})),function(){return e})})}function M(e){return c(e).allSettled()}function j(e,t){return c(e).then(void 0,void 0,t)}function F(e,t){return c(e).nodeify(t)}var z=!1;try{throw new Error}catch(V){z=!!V.stack}var U,B,$=l(),H=function(){},Q=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var i=t.domain;if(i)t.domain=void 0,i.enter();try{n()}catch(o){if(s){if(i)i.exit();if(setTimeout(e,0),i)i.enter();throw o}else setTimeout(function(){throw o},0)}if(i)i.exit()}r=!1}var t={task:void 0,next:null},n=t,r=!1,i=void 0,s=!1;if(Q=function(e){if(n=n.next={task:e,domain:s&&process.domain,next:null},!r)r=!0,i()},"undefined"!=typeof process&&process.nextTick)s=!0,i=function(){process.nextTick(e)};else if("function"==typeof setImmediate)if("undefined"!=typeof window)i=setImmediate.bind(window,e);else i=function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var o=new MessageChannel;o.port1.onmessage=function(){i=a,o.port1.onmessage=e,e()};var a=function(){o.port2.postMessage(0)};i=function(){setTimeout(e,0),a()}}else i=function(){setTimeout(e,0)};return Q}(),J=Function.call,Z=e(Array.prototype.slice),W=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)if(n in this)t=e(t,this[n],n);return t}),G=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),K=e(Array.prototype.map||function(e,t){var n=this,r=[];return W(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),X=Object.create||function(e){function t(){}return t.prototype=e,new t},Y=e(Object.prototype.hasOwnProperty),et=Object.keys||function(e){var t=[];for(var n in e)if(Y(e,n))t.push(n);return t},tt=e(Object.prototype.toString);if("undefined"!=typeof ReturnValue)B=ReturnValue;else B=function(e){this.value=e};var nt="From previous event:";c.resolve=c,c.nextTick=Q,c.longStackSupport=!1,c.defer=f,f.prototype.makeNodeResolver=function(){var e=this;return function(t,n){if(t)e.reject(t);else if(arguments.length>2)e.resolve(Z(arguments,1));else e.resolve(n)}},c.Promise=d,c.promise=d,d.race=p,d.all=L,d.reject=A,d.resolve=c,c.passByCopy=function(e){return e},m.prototype.passByCopy=function(){return this},c.join=function(e,t){return c(e).join(t)},m.prototype.join=function(e){return c([this,e]).spread(function(e,t){if(e===t)return e;else throw new Error("Can't join: not the same: "+e+" "+t)})},c.race=p,m.prototype.race=function(){return this.then(c.race)},c.makePromise=m,m.prototype.toString=function(){return"[object Promise]"},m.prototype.then=function(e,t,n){function i(t){try{return"function"==typeof e?e(t):t}catch(n){return A(n)}}function s(e){if("function"==typeof t){r(e,a);try{return t(e)}catch(n){return A(n)}}return A(e)}function o(e){return"function"==typeof n?n(e):e}var a=this,l=f(),u=!1;return Q(function(){a.promiseDispatch(function(e){if(!u)u=!0,l.resolve(i(e))},"when",[function(e){if(!u)u=!0,l.resolve(s(e))}])}),a.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=o(e)}catch(r){if(n=!0,c.onerror)c.onerror(r);else throw r}if(!n)l.notify(t)}]),l.promise},c.when=h,m.prototype.thenResolve=function(e){return this.then(function(){return e})},c.thenResolve=function(e,t){return c(e).thenResolve(t)},m.prototype.thenReject=function(e){return this.then(function(){throw e})},c.thenReject=function(e,t){return c(e).thenReject(t)},c.nearer=g,c.isPromise=v,c.isPromiseAlike=b,c.isPending=y,m.prototype.isPending=function(){return"pending"===this.inspect().state},c.isFulfilled=w,m.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},c.isRejected=x,m.prototype.isRejected=function(){return"rejected"===this.inspect().state};var rt=[],it=[],st=!0;c.resetUnhandledRejections=S,c.getUnhandledReasons=function(){return rt.slice()},c.stopUnhandledRejectionTracking=function(){S(),st=!1},S(),c.reject=A,c.fulfill=E,c.master=R,c.spread=I,m.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},c.async=_,c.spawn=N,c["return"]=T,c.promised=P,c.dispatch=D,m.prototype.dispatch=function(e,t){var n=this,r=f();return Q(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},c.get=function(e,t){return c(e).dispatch("get",[t])},m.prototype.get=function(e){return this.dispatch("get",[e])},c.set=function(e,t,n){return c(e).dispatch("set",[t,n])},m.prototype.set=function(e,t){return this.dispatch("set",[e,t])},c.del=c["delete"]=function(e,t){return c(e).dispatch("delete",[t])},m.prototype.del=m.prototype["delete"]=function(e){return this.dispatch("delete",[e])},c.mapply=c.post=function(e,t,n){return c(e).dispatch("post",[t,n])},m.prototype.mapply=m.prototype.post=function(e,t){return this.dispatch("post",[e,t])},c.send=c.mcall=c.invoke=function(e,t){return c(e).dispatch("post",[t,Z(arguments,2)])},m.prototype.send=m.prototype.mcall=m.prototype.invoke=function(e){return this.dispatch("post",[e,Z(arguments,1)])},c.fapply=function(e,t){return c(e).dispatch("apply",[void 0,t])},m.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},c["try"]=c.fcall=function(e){return c(e).dispatch("apply",[void 0,Z(arguments,1)])},m.prototype.fcall=function(){return this.dispatch("apply",[void 0,Z(arguments)])},c.fbind=function(e){var t=c(e),n=Z(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(Z(arguments))])}},m.prototype.fbind=function(){var e=this,t=Z(arguments);return function(){return e.dispatch("apply",[this,t.concat(Z(arguments))])}},c.keys=function(e){return c(e).dispatch("keys",[])},m.prototype.keys=function(){return this.dispatch("keys",[])},c.all=L,m.prototype.all=function(){return L(this)},c.allResolved=u(O,"allResolved","allSettled"),m.prototype.allResolved=function(){return O(this)},c.allSettled=M,m.prototype.allSettled=function(){return this.then(function(e){return L(K(e,function(e){function t(){return e.inspect()}return e=c(e),e.then(t,t)}))})},c.fail=c["catch"]=function(e,t){return c(e).then(void 0,t)},m.prototype.fail=m.prototype["catch"]=function(e){return this.then(void 0,e)},c.progress=j,m.prototype.progress=function(e){return this.then(void 0,void 0,e)},c.fin=c["finally"]=function(e,t){return c(e)["finally"](t)},m.prototype.fin=m.prototype["finally"]=function(e){return e=c(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},c.done=function(e,t,n,r){return c(e).done(t,n,r)},m.prototype.done=function(e,t,n){var i=function(e){Q(function(){if(r(e,s),c.onerror)c.onerror(e);else throw e})},s=e||t||n?this.then(e,t,n):this;if("object"==typeof process&&process&&process.domain)i=process.domain.bind(i);s.then(void 0,i)},c.timeout=function(e,t,n){return c(e).timeout(t,n)},m.prototype.timeout=function(e,t){var n=f(),r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},c.delay=function(e,t){if(void 0===t)t=e,e=void 0;return c(e).delay(t)},m.prototype.delay=function(e){return this.then(function(t){var n=f();return setTimeout(function(){n.resolve(t)},e),n.promise})},c.nfapply=function(e,t){return c(e).nfapply(t)},m.prototype.nfapply=function(e){var t=f(),n=Z(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},c.nfcall=function(e){var t=Z(arguments,1);return c(e).nfapply(t)},m.prototype.nfcall=function(){var e=Z(arguments),t=f();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},c.nfbind=c.denodeify=function(e){var t=Z(arguments,1);return function(){var n=t.concat(Z(arguments)),r=f();return n.push(r.makeNodeResolver()),c(e).fapply(n).fail(r.reject),r.promise}},m.prototype.nfbind=m.prototype.denodeify=function(){var e=Z(arguments);return e.unshift(this),c.denodeify.apply(void 0,e)},c.nbind=function(e,t){var n=Z(arguments,2);return function(){function r(){return e.apply(t,arguments)}var i=n.concat(Z(arguments)),s=f();return i.push(s.makeNodeResolver()),c(r).fapply(i).fail(s.reject),s.promise}},m.prototype.nbind=function(){var e=Z(arguments,0);return e.unshift(this),c.nbind.apply(void 0,e)},c.nmapply=c.npost=function(e,t,n){return c(e).npost(t,n)},m.prototype.nmapply=m.prototype.npost=function(e,t){var n=Z(t||[]),r=f();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},c.nsend=c.nmcall=c.ninvoke=function(e,t){var n=Z(arguments,2),r=f();return n.push(r.makeNodeResolver()),c(e).dispatch("post",[t,n]).fail(r.reject),r.promise},m.prototype.nsend=m.prototype.nmcall=m.prototype.ninvoke=function(e){var t=Z(arguments,1),n=f();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},c.nodeify=F,m.prototype.nodeify=function(e){if(e)this.then(function(t){Q(function(){e(null,t)})},function(t){Q(function(){e(t)})});else return this};var ot=l();return c});