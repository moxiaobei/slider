/*! 2015 Baidu Inc. All Rights Reserved */
define("common/lib/invoker",["require","exports","zepto","common/lib/env","openjs"],function(require,exports){var e=require("zepto"),t=require("common/lib/env"),n=require("openjs"),r=function(){var e=/([iI][rR]|[gG][dD]|[eE][sS])-(\w{8}-\w{4}-\w{4}-\w{4}-\w{12})/,t=location.pathname.match(e);if(t)t=t[0];else t=null;return function(){return t}}(),i=function(){var i=e("#imageSearchType").val()||"GENERAL",s={},a=encodeURIComponent(window.location.href);if(window._t_url)s.key=null,s.url=window._t_url;else s.key=r(),s.url=null;if(t.os.ios)return function(){t.ready(function(){s.referrer="http://qingpai.baidu.com/";var e=window.location.href;n.ios.invokeApp("imagesearch",{action:"editimage",args:encodeURIComponent("source_app=BROWSER&referer="+e+"&imageSearch_type="+i),params:encodeURIComponent(JSON.stringify(s)),minver:encodeURIComponent("5.5.0.0")})})};if(t.os.android)return function(){t.ready(function(){s.imageSearch_type=i,s.source_app="BROWSER",s.referer=a,n.android.invokeApp("Bdbox_android_imagesearch","editImage",[JSON.stringify(s)])})};else return function(){alert("暂时不支持非 Android，iOS 平台")}}(),s=function(){var i=e("#imageSearchType").val()||"GENERAL",s={},a=encodeURIComponent(window.location.href);if(window._t_url)s.key=null,s.url=window._t_url;else s.key=r(),s.url=null;if(t.os.ios)return function(){t.ready(function(){s.referrer="http://qingpai.baidu.com/";var e=window.location.href;n.ios.invokeApp("imagesearch",{action:"imagesearch",params:encodeURIComponent(JSON.stringify(s)),args:encodeURIComponent("source_app=BROWSER&referer="+e+"&imageSearch_type="+i),minver:encodeURIComponent("3.8.0.0")})})};if(t.os.android)return function(){t.ready(function(){n.android.invokeApp("Bdbox_android_send_intent","send",["intent:widgetid://com.baidu.searchbox/-1#Intent;action=com.baidu.searchbox.action.MAIN;category=android.intent.category.LAUNCHER;component=com.baidu.searchbox/.CodeScannerActivity;launchFlags=0x10000000;S.from=7;S.source_app=BROWSER;S.referer="+a+";S.imageSearch_type="+i+";end"])})};else return function(){alert("暂时不支持非 Android，iOS 平台")}}();return exports.initCallEditor=function(t){t=t||".c-invoke-edit-btn";var n=e(t);n.on("click",function(e){e.preventDefault(),i()})},exports.initCallImageSearch=function(e){e=e||".c-invoke-image-search";var t=document.querySelector(e);if(t)t.addEventListener("click",function(e){e.preventDefault(),s()})},exports.initSetQuery=function(){window.addEventListener("pageshow",function(){t.ready(function(){if(t.os.ios)n.ios.invokeApp("setquery",{params:encodeURIComponent(JSON.stringify({type:"image",query:window._t_base64})),minver:encodeURIComponent("5.5.0.0")});if(t.os.android)n.android.invokeApp("Bdbox_android_common","setQuery",[JSON.stringify({type:"image",query:window._t_base64})])})},!0)},exports});